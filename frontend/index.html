<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kids3D Teacher - Your English Learning Companion ğŸ•·ï¸</title>
  
  <!-- Optimized fonts (removed heavy Fredoka One) -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="frame">
    
    <!-- ========================================
         LEFT PANEL - AVATAR COMPANION
         ======================================== -->
    <div class="panel left" role="main" aria-label="Avatar Companion">
      <h1>ğŸ•·ï¸ Spidey Teacher</h1>
      <p class="subtitle">
        Your friendly companion for learning English
      </p>

      <!-- 3D Avatar Container (UNCHANGED - Critical for Three.js) -->
      <div id="canvas-container" aria-label="3D Avatar Companion">
        <div id="avatar-scroll-safe"></div>
        
        <!-- Dynamic Caption Box (Replika-style overlay) -->
        <div id="caption-box" class="caption-box">
          <div class="caption-icon">ğŸ’¬</div>
          <div id="caption-text" class="caption-text">
            Hey friend! Click the mic to start chatting...
          </div>
        </div>
      </div>

      <!-- Simplified Controls - Hero Mic Button + Hidden Menu -->
      <div class="floating-controls" role="toolbar">
        <!-- HERO MIC BUTTON (Primary Action) -->
        <button id="micBtn" class="control-btn mic-btn" title="Talk to Spidey">
          <span class="icon">ğŸ¤</span>
          <span class="label">Talk to Spidey</span>
        </button>
        
        <!-- TEST BUTTON (Secondary Action) -->
        <button id="testBtn" class="control-btn test-btn" title="Test Connection">
          <span class="icon">ğŸ§ª</span>
        </button>

        <!-- HIDDEN MENU BUTTON (Advanced Options) -->
        <div style="position: relative;">
          <button id="menuBtn" title="More Options">â‹®</button>
          <div id="advancedMenu">
            <button id="clearBtn">ğŸ”„ Start Fresh Chat</button>
            <button id="demoLessonBtn">ğŸ¯ Daily Challenge</button>
          </div>
        </div>
      </div>

      <!-- Status Bar (Friendly Messages) -->
      <div id="status" class="status-bar" aria-live="polite">
        Hey friend! Ready to chat? ğŸ‘‹
      </div>

      <footer class="small">
        Chat naturally â€¢ Learn English â€¢ Have fun âœ¨<br>
        Your friendly companion, available 24/7
      </footer>
    </div>

    <!-- ========================================
         RIGHT PANEL - CHAT TIMELINE (REPLIKA STYLE)
         ======================================== -->
    <div class="panel right" role="complementary">
      <h1>ğŸ’¬ Chat with Spidey</h1>

      <!-- Input Row (Type or speak) -->
      <div class="input-row">
        <input 
          id="chatInput" 
          type="text" 
          placeholder="Type a message..." 
          aria-label="Type message" 
        />
        <button id="sendBtn" class="send-btn">Send</button>
      </div>

      <!-- CHAT TIMELINE (Main Feature - Replika Style) -->
      <div id="chatTimeline" class="chat-timeline">
        <!-- Messages will be dynamically inserted here by app.js -->
        <!-- Example structure (generated by JavaScript):
        
        <div class="message-bubble user">
          <div class="bubble-content">
            Hello Spidey!
          </div>
          <div class="timestamp">2:30 PM</div>
        </div>
        
        <div class="message-bubble assistant">
          <div class="avatar-icon">ğŸ•·ï¸</div>
          <div class="bubble-content">
            Hey! Great to see you! ğŸ˜Š
            <div class="correction-hint perfect">âœ… Perfect sentence!</div>
          </div>
          <div class="timestamp">2:30 PM</div>
        </div>
        
        -->
      </div>

      <!-- Mode Toggle (Simplified - Hidden by Default) -->
      <div class="mode-section">
        <strong class="section-title">Mode</strong>
        <button id="modeToggle" class="mode-toggle">
          <span class="mode-text"></span>
          <div class="mode-switch"></div>
        </button>
        <p class="small mode-description">
          Casual = fun chat â€¢ Practice = grammar help
        </p>
      </div>

      <!-- Class Selection (Simplified) -->
      <div class="class-section">
        <strong class="section-title">Level</strong>
        <div id="classButtons" class="class-buttons">
          <button class="class-btn" data-class="class3">Class 3</button>
          <button class="class-btn active" data-class="class7">Class 7</button>
          <button class="class-btn" data-class="class10">Class 10</button>
        </div>
      </div>

      <!-- Hidden select for backend compatibility -->
      <select id="schoolMode" style="display:none">
        <option value="class3">Class 3</option>
        <option value="class7" selected>Class 7</option>
        <option value="class10">Class 10</option>
      </select>

      <!-- Status Log (Minimized - For Debugging) -->
      <div class="log-section">
        <strong class="section-title">Debug Log</strong>
        <div id="log" class="log-content"></div>
      </div>
    </div>
  </div>

  <!-- External Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <!-- App Entry Point -->
  <script type="module" src="/src/app.js"></script>
</body>
</html>