<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#667eea" />
  <meta name="description" content="English Learning Companion - Practice English with your AI friend" />
  
  <title>English Learning Companion âœ¨</title>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  
  <div class="immersive-container">
  <!-- Tagline (top-left) -->
  <div class="tagline">
  <div class="tagline-main">The AI companion who cares</div>
  <div class="tagline-sub">Always here to listen and talk.<br>Always on your side.</div>
</div>
    <!-- 3D Avatar Container -->
    <div id="canvas-container" aria-label="Your English Companion">
      <div id="avatar-scroll-safe"></div>
      
      <!-- Loading Indicator -->
      <div id="loading-indicator" class="loading-indicator">
        <div class="loading-spinner"></div>
        <span>Loading...</span>
      </div>
    </div>

    <!-- Microphone Button (bottom-left) -->
    <div id="mic-container">
      <button id="micBtn" class="mic-small" title="Start conversation" aria-label="Start or pause conversation">
        ğŸ¤
      </button>
    </div>

    <!-- AI Reply Caption (bottom center) -->
    <div id="chatCaption" class="chat-caption" role="status" aria-live="polite">
      Ready to chat! ğŸ’­
    </div>

    <!-- Status Message (top center) -->
    <div id="status" class="status-message" aria-live="polite">
      Ready to chat! ğŸ’­
    </div>

    <!-- Menu Toggle Button (top right) -->
    <button id="menuToggle" class="menu-toggle" title="Settings" aria-label="Open settings menu">
      â‹®
    </button>
    
    <!-- Settings Menu Panel -->
    <div id="menuPanel" class="menu-panel" role="dialog" aria-label="Settings">
      <div class="menu-header">
        <h3>Settings</h3>
        <button id="menuClose" class="menu-close" aria-label="Close settings">Ã—</button>
      </div>
      
      <div class="menu-content">
        
        <!-- Avatar Selection -->
        <div class="menu-item">
          <label>Choose Avatar</label>
          <div class="avatar-grid">
            <button class="avatar-option active" data-avatar="/assets/vrmavatar1.vrm" title="Avatar 1" aria-label="Select Avatar 1">
              <span class="avatar-emoji">ğŸ‘§</span>
            </button>
            <button class="avatar-option" data-avatar="/assets/vrmavatar2.vrm" title="Avatar 2" aria-label="Select Avatar 2">
              <span class="avatar-emoji">ğŸ‘©</span>
            </button>
            <button class="avatar-option" data-avatar="/assets/vrmavatar3.vrm" title="Avatar 3" aria-label="Select Avatar 3">
              <span class="avatar-emoji">ğŸ‘±â€â™€ï¸</span>
            </button>
            <button class="avatar-option" data-avatar="/assets/vrmavatar4.vrm" title="Avatar 4" aria-label="Select Avatar 4">
              <span class="avatar-emoji">ğŸ§‘</span>
            </button>
          </div>
        </div>

        <!-- Divider -->
        <div class="menu-divider"></div>

        <!-- Background Music -->
        <div class="menu-item">
          <label>Background Music</label>
          <button id="musicToggle" class="mode-toggle-btn" aria-label="Toggle background music">
            <span class="mode-label">Music Off</span>
            <div class="toggle-switch"></div>
          </button>
          <div class="volume-control">
            <span class="volume-icon">ğŸ”Š</span>
            <input 
              type="range" 
              id="musicVolume" 
              min="0" 
              max="100" 
              value="30" 
              class="volume-slider"
              aria-label="Music volume"
            >
          </div>
        </div>

        <!-- Divider -->
        <div class="menu-divider"></div>

        <!-- Conversation Mode Toggle -->
        <div class="menu-item">
          <label>Conversation Mode</label>
          <button id="modeToggle" class="mode-toggle-btn" aria-label="Toggle conversation mode">
            <span class="mode-label">Casual Chat</span>
            <div class="toggle-switch"></div>
          </button>
          <p class="menu-hint">Casual = friendly chat â€¢ Practice = grammar help</p>
        </div>

        <!-- Practice Mode Corrections Display -->
        <div id="correctionDisplay" class="menu-item" style="display: none;">
          <label>Latest Correction</label>
          <div id="correctionContent" class="correction-display"></div>
        </div>

        <!-- Divider -->
        <div class="menu-divider"></div>

        <!-- Action Buttons -->
        <div class="menu-item">
          <button id="clearBtn" class="menu-action-btn" aria-label="Start fresh conversation">
            ğŸ”„ Start Fresh Conversation
          </button>
        </div>

        <div class="menu-item">
          <button id="demoLessonBtn" class="menu-action-btn" aria-label="Get daily challenge">
            âœ¨ Daily Challenge
          </button>
        </div>

        <!-- Debug Log (collapsed by default) -->
        <details class="menu-item">
          <summary>Debug Log</summary>
          <div id="log" class="debug-log"></div>
        </details>
      </div>
    </div>

    <!-- Menu Overlay (for closing menu when clicking outside) -->
    <div id="menuOverlay" class="menu-overlay"></div>

  </div>

  <!-- External Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  
  <!-- Main Application -->
  <script type="module" src="/src/app.js"></script>
</body>
</html>