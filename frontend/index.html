<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kids3D Teacher - Interactive Learning ğŸ“</title>
  
  <!-- Modern fonts for kids -->
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&family=Poppins:wght@500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <div class="frame">
    
    <!-- ========================================
         LEFT PANEL - AVATAR STUDIO
         ======================================== -->
    <div class="panel left" role="main" aria-label="Avatar Studio">
      <h1>Kids3D Teacher ğŸ“</h1>
      <p class="subtitle">
        Learn English with fun â€¢ Practice speaking â€¢ Get instant feedback!
      </p>

      <!-- 3D Avatar Container (UNCHANGED - Critical for Three.js) -->
      <div id="canvas-container" aria-label="3D Avatar">
        <div id="avatar-scroll-safe"></div>
        
        <!-- NEW: Dynamic Caption Box (Overlay at bottom) -->
        <div id="caption-box" class="caption-box">
          <div class="caption-icon">ğŸ”Š</div>
          <div id="caption-text" class="caption-text">
            Avatar is ready! Click the mic to start...
          </div>
        </div>
      </div>

      <!-- NEW: Floating Control Bar (Modern redesign of existing buttons) -->
      <div class="floating-controls" role="toolbar">
        <button id="micBtn" class="control-btn mic-btn" title="Start/Stop Recording">
          <span class="icon">ğŸ¤</span>
          <span class="label">Speak</span>
        </button>
        
        <button id="pauseTtsBtn" class="control-btn pause-btn" title="Pause Speech">
          <span class="icon">â¸</span>
        </button>
        
        <button id="resumeTtsBtn" class="control-btn resume-btn" style="display:none" title="Resume Speech">
          <span class="icon">â–¶</span>
        </button>
        
        <button id="stopTtsBtn" class="control-btn stop-btn" title="Stop Speech">
          <span class="icon">â¹</span>
        </button>
        
        <button id="testBtn" class="control-btn test-btn" title="Test Connection">
          <span class="icon">ğŸ§ª</span>
        </button>
      </div>

      <!-- Status Indicator -->
      <div id="status" class="status-bar" aria-live="polite">
        Ready when you are! ğŸ¯
      </div>

      <footer class="small">
        Speak naturally â€¢ Get corrections â€¢ Build confidence âœ¨<br>
        Works on phone, tablet, laptop â€¢ Made with â¤ï¸ for learning
      </footer>
    </div>

    <!-- ========================================
         RIGHT PANEL - MY SPEECH LOG (CORRECTION HUB)
         ======================================== -->
    <div class="panel right" role="complementary">
      <h1>ğŸ“ My Speech Log</h1>

      <!-- Typed Input (Keep for manual testing) -->
      <div class="input-row">
        <input id="chatInput" type="text" placeholder="Type to practice..." aria-label="Type message" />
        <button id="sendBtn" class="send-btn">Send</button>
      </div>

      <!-- NEW: Correction Cards Container (Replaces simple conversation scroll) -->
      <div id="conversationScroll" class="corrections-container">
        <!-- Hidden elements kept for backward compatibility -->
        <div id="transcript" class="bubble user" style="display:none"></div>
        <div id="reply" class="bubble" style="display:none"></div>
        
        <!-- Dynamic correction cards will be inserted here -->
        <div id="correction-cards">
          <!-- Example structure (will be generated by JS):
          <div class="correction-card">
            <div class="error-section">
              <div class="icon">âŒ</div>
              <div class="content">
                <strong>You said:</strong> "what was time now"
              </div>
            </div>
            <div class="success-section">
              <div class="icon">âœ…</div>
              <div class="content">
                <strong>Corrected:</strong> "What is the time now?"
              </div>
            </div>
          </div>
          -->
        </div>
      </div>

      <!-- Mode Toggle (Keep existing functionality) -->
      <div class="mode-section">
        <strong class="section-title">Conversation Mode</strong>
        <button id="modeToggle" class="mode-toggle">
          <span class="mode-text"></span>
          <div class="mode-switch"></div>
        </button>
        <p class="small mode-description">
          Casual = fun chat â€¢ Practice = grammar correction + repeat
        </p>
      </div>

      <!-- Class Selection (Keep existing) -->
      <div class="class-section">
        <strong class="section-title">Choose Your Class</strong>
        <div id="classButtons" class="class-buttons">
          <button class="class-btn active" data-class="class3">Class 3</button>
          <button class="class-btn" data-class="class7">Class 7</button>
          <button class="class-btn" data-class="class10">Class 10</button>
        </div>
      </div>

      <!-- Hidden select for backend compatibility -->
      <select id="schoolMode" style="display:none">
        <option value="class3">Class 3</option>
        <option value="class7" selected>Class 7</option>
        <option value="class10">Class 10</option>
      </select>

      <!-- Action Buttons -->
      <div class="action-buttons">
        <button id="clearBtn" class="action-btn clear-btn">
          ğŸ—‘ï¸ New Session
        </button>
        <button id="demoLessonBtn" class="action-btn demo-btn">
          ğŸ¯ Daily Challenge
        </button>
      </div>

      <!-- Status Log (Keep for debugging) -->
      <div class="log-section">
        <strong class="section-title">Status Log</strong>
        <div id="log" class="log-content"></div>
      </div>
    </div>
  </div>

  <!-- External Dependencies -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <!-- App Entry Point -->
  <script type="module" src="/src/app.js"></script>
</body>
</html>