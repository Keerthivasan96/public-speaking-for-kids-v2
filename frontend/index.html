<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>English Learning Companion âœ¨</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  
  <div class="immersive-container">
    
    <!-- 3D Avatar Container -->
    <div id="canvas-container" aria-label="Your English Companion">
      <div id="avatar-scroll-safe"></div>
      
      <!-- Loading Indicator -->
      <div id="loading-indicator" class="loading-indicator">
        <div class="loading-spinner"></div>
        <span>Loading avatar...</span>
      </div>
    </div>

    <!-- Mic Button (bottom-left) -->
    <div id="mic-container">
      <button id="micBtn" class="mic-small" title="Start conversation">
        ğŸ¤
      </button>
    </div>

    <!-- AI Reply Caption (bottom center) -->
    <div id="chatCaption" class="chat-caption" role="status" aria-live="polite">
      Ready to chat! ğŸ’­
    </div>

    <!-- Status (top center) -->
    <div id="status" class="status-message" aria-live="polite">
      Ready to chat! ğŸ’­
    </div>

    <!-- Menu Toggle (top right) -->
    <button id="menuToggle" class="menu-toggle" title="Options">â‹®</button>
    
    <!-- Settings Menu Panel -->
    <div id="menuPanel" class="menu-panel">
      <div class="menu-header">
        <h3>Settings</h3>
        <button id="menuClose" class="menu-close">Ã—</button>
      </div>
      
      <div class="menu-content">
        
        <!-- Avatar Selection -->
        <div class="menu-item">
          <label>Choose Avatar</label>
          <div class="avatar-grid">
            <button class="avatar-option active" data-avatar="/assets/vrmavatar1.vrm" title="Avatar 1">
              <span class="avatar-emoji">ğŸ‘§</span>
            </button>
            <button class="avatar-option" data-avatar="/assets/vrmavatar2.vrm" title="Avatar 2">
              <span class="avatar-emoji">ğŸ‘©</span>
            </button>
            <button class="avatar-option" data-avatar="/assets/vrmavatar3.vrm" title="Avatar 3">
              <span class="avatar-emoji">ğŸ‘±â€â™€ï¸</span>
            </button>
            <button class="avatar-option" data-avatar="/assets/vrmavatar4.vrm" title="Avatar 4">
              <span class="avatar-emoji">ğŸ§‘</span>
            </button>
          </div>
        </div>

        <!-- Divider -->
        <div class="menu-divider"></div>

        <!-- 3D Room Toggle -->
        <div class="menu-item">
          <label>3D Room</label>
          <button id="roomToggle" class="mode-toggle-btn">
            <span class="mode-label">Room Off</span>
            <div class="toggle-switch"></div>
          </button>
          <p class="menu-hint">Load 3D room environment</p>
        </div>

        <!-- Divider -->
        <div class="menu-divider"></div>

        <!-- Background Music -->
        <div class="menu-item">
          <label>Background Music</label>
          <button id="musicToggle" class="mode-toggle-btn">
            <span class="mode-label">Music Off</span>
            <div class="toggle-switch"></div>
          </button>
          <div class="volume-control">
            <span class="volume-icon">ğŸ”Š</span>
            <input type="range" id="musicVolume" min="0" max="100" value="30" class="volume-slider">
          </div>
        </div>

        <!-- Divider -->
        <div class="menu-divider"></div>

        <!-- Conversation Mode Toggle -->
        <div class="menu-item">
          <label>Conversation Mode</label>
          <button id="modeToggle" class="mode-toggle-btn">
            <span class="mode-label">Casual Chat</span>
            <div class="toggle-switch"></div>
          </button>
          <p class="menu-hint">Casual = friendly chat â€¢ Practice = grammar help</p>
        </div>

        <!-- Practice Mode Corrections -->
        <div id="correctionDisplay" class="menu-item" style="display: none;">
          <label>Latest Correction</label>
          <div id="correctionContent" class="correction-display"></div>
        </div>

        <!-- Divider -->
        <div class="menu-divider"></div>

        <!-- Actions -->
        <div class="menu-item">
          <button id="clearBtn" class="menu-action-btn">
            ğŸ”„ Start Fresh Conversation
          </button>
        </div>

        <div class="menu-item">
          <button id="demoLessonBtn" class="menu-action-btn">
            âœ¨ Daily Challenge
          </button>
        </div>

        <!-- Debug Log -->
        <details class="menu-item">
          <summary>Debug Log</summary>
          <div id="log" class="debug-log"></div>
        </details>
      </div>
    </div>

    <!-- Overlay -->
    <div id="menuOverlay" class="menu-overlay"></div>

  </div>

  <!-- External Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>
  
  <!-- Main App -->
  <script type="module" src="/src/app.js"></script>
</body>
</html>